<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symmetric Base Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- KaTeX for LaTeX rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vniwctzAFta15+" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .input-symbol {
            font-variant-numeric: tabular-nums;
        }
        /* Ensure footer stays at bottom even on short screens if content is small,
           but scrolls if content is long */
        html, body {
            height: 100%;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

<!-- Fixed Header for Language Toggle -->
<header class="fixed top-0 left-0 right-0 bg-white shadow-sm z-50 px-4 py-3 flex items-center">
    <button
            id="langToggle"
            class="bg-slate-100 hover:bg-slate-200 px-3 py-2 rounded-lg text-sm font-semibold text-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors flex items-center gap-2"
            aria-label="Toggle Language"
    >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
        </svg>
        <span id="langLabel">EN</span>
    </button>
</header>

<!-- Main Content Area -->
<main class="flex-grow flex flex-col items-center justify-center p-4 pt-24 pb-12">
    <div class="bg-white rounded-xl shadow-lg w-full max-w-4xl overflow-hidden">
        <!-- Converter Header -->
        <div class="bg-slate-800 p-6 text-white">
            <h1 class="text-2xl font-bold" data-i18n="title">Conversor de Bases Simétricas</h1>
            <p class="text-slate-300 text-sm mt-1" data-i18n="subtitle">Ternário Balanceado (Base 3) ⇄ Nonário Simétrico (Base 9)</p>
        </div>

        <div class="p-6 md:p-8 grid grid-cols-1 lg:grid-cols-5 gap-8">

            <!-- Converter Section -->
            <div class="lg:col-span-3 space-y-6">

                <!-- Ternary Input -->
                <div>
                    <label for="ternaryInput" class="block text-sm font-medium text-slate-700 mb-2" data-i18n="ternaryLabel">
                        Ternário Balanceado (trits)
                    </label>
                    <div class="relative">
                        <input
                                type="text"
                                id="ternaryInput"
                                placeholder="+ - 0"
                                class="w-full text-xl p-4 border-2 border-slate-200 rounded-lg focus:border-blue-500 focus:ring-blue-500 transition-colors input-symbol font-mono"
                                autocomplete="off"
                        >
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <span class="text-slate-400 text-sm" data-i18n="base3">Base 3</span>
                        </div>
                    </div>
                    <p class="text-xs text-slate-500 mt-2" data-i18n="allowedChars3">Caracteres permitidos: +, -, 0</p>
                </div>

                <!-- Swap Icon (Visual only) -->
                <div class="flex justify-center -my-2 relative z-10 lg:hidden">
                    <div class="bg-slate-100 p-2 rounded-full text-slate-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                        </svg>
                    </div>
                </div>

                <!-- Nonary Input -->
                <div>
                    <label for="nonaryInput" class="block text-sm font-medium text-slate-700 mb-2" data-i18n="nonaryLabel">
                        Nonário Simétrico
                    </label>
                    <div class="relative">
                        <input
                                type="text"
                                id="nonaryInput"
                                placeholder="W X Y Z 0 1 2 3 4"
                                class="w-full text-xl p-4 border-2 border-slate-200 rounded-lg focus:border-purple-500 focus:ring-purple-500 transition-colors input-symbol font-mono uppercase"
                                autocomplete="off"
                        >
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <span class="text-slate-400 text-sm" data-i18n="base9">Base 9</span>
                        </div>
                    </div>
                    <p class="text-xs text-slate-500 mt-2" data-i18n="allowedChars9">Caracteres permitidos: W, X, Y, Z, 0, 1, 2, 3, 4</p>
                </div>

                <!-- Decimal Value Display -->
                <div class="pt-4 border-t border-slate-100">
                    <div class="flex items-center justify-between bg-slate-50 p-4 rounded-lg">
                        <span class="text-sm font-medium text-slate-600" data-i18n="decimalLabel">Valor Decimal (Base 10):</span>
                        <span id="decimalValue" class="text-lg font-bold text-slate-800 font-mono">0</span>
                    </div>
                </div>

            </div>

            <!-- Reference Table -->
            <div class="lg:col-span-2 bg-slate-50 rounded-xl border border-slate-100 p-4 h-fit">
                <h3 class="text-sm font-semibold text-slate-800 mb-3 uppercase tracking-wider text-center" data-i18n="tableTitle">
                    Tabela de Mapeamento
                </h3>
                <div class="overflow-hidden rounded-lg border border-slate-200">
                    <table class="min-w-full divide-y divide-slate-200 text-sm text-center">
                        <thead class="bg-slate-100">
                        <tr>
                            <th class="py-2 px-3 text-slate-600 font-semibold" data-i18n="thNonary">Nonário</th>
                            <th class="py-2 px-3 text-slate-600 font-semibold" data-i18n="thValue">Valor</th>
                            <th class="py-2 px-3 text-slate-600 font-semibold" data-i18n="thTernary">Ternário</th>
                        </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-200 bg-white">
                        <tr class="bg-purple-50/50">
                            <td class="py-2 px-3 font-mono font-bold text-purple-700">4</td>
                            <td class="py-2 px-3 text-slate-500">+4</td>
                            <td class="py-2 px-3 font-mono">++</td>
                        </tr>
                        <tr>
                            <td class="py-2 px-3 font-mono font-bold text-purple-700">3</td>
                            <td class="py-2 px-3 text-slate-500">+3</td>
                            <td class="py-2 px-3 font-mono">+0</td>
                        </tr>
                        <tr>
                            <td class="py-2 px-3 font-mono font-bold text-purple-700">2</td>
                            <td class="py-2 px-3 text-slate-500">+2</td>
                            <td class="py-2 px-3 font-mono">+-</td>
                        </tr>
                        <tr>
                            <td class="py-2 px-3 font-mono font-bold text-purple-700">1</td>
                            <td class="py-2 px-3 text-slate-500">+1</td>
                            <td class="py-2 px-3 font-mono">0+</td>
                        </tr>
                        <tr class="bg-slate-50">
                            <td class="py-2 px-3 font-mono font-bold text-slate-700">0</td>
                            <td class="py-2 px-3 text-slate-500">0</td>
                            <td class="py-2 px-3 font-mono">00</td>
                        </tr>
                        <tr>
                            <td class="py-2 px-3 font-mono font-bold text-purple-700">Z</td>
                            <td class="py-2 px-3 text-slate-500">-1</td>
                            <td class="py-2 px-3 font-mono">0-</td>
                        </tr>
                        <tr>
                            <td class="py-2 px-3 font-mono font-bold text-purple-700">Y</td>
                            <td class="py-2 px-3 text-slate-500">-2</td>
                            <td class="py-2 px-3 font-mono">-+</td>
                        </tr>
                        <tr>
                            <td class="py-2 px-3 font-mono font-bold text-purple-700">X</td>
                            <td class="py-2 px-3 text-slate-500">-3</td>
                            <td class="py-2 px-3 font-mono">-0</td>
                        </tr>
                        <tr class="bg-purple-50/50">
                            <td class="py-2 px-3 font-mono font-bold text-purple-700">W</td>
                            <td class="py-2 px-3 text-slate-500">-4</td>
                            <td class="py-2 px-3 font-mono">--</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Explanation Footer -->
    <footer class="w-full max-w-4xl mt-8 text-slate-600 text-sm">
        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
            <h2 class="text-lg font-bold text-slate-800 mb-3" data-i18n="footerTitle">Como funciona a conversão?</h2>
            <div class="space-y-4" data-i18n-html="footerContent" id="footerContentContainer">
                <!-- Content will be injected by JS based on language -->
            </div>
        </div>
    </footer>

</main>

<script>
    // --- I18n Configuration ---
    const translations = {
        pt: {
            title: "Conversor de Bases Simétricas",
            subtitle: "Ternário Balanceado (Base 3) ⇄ Nonário Simétrico (Base 9)",
            ternaryLabel: "Ternário Balanceado (trits)",
            base3: "Base 3",
            allowedChars3: "Caracteres permitidos: +, -, 0",
            nonaryLabel: "Nonário Simétrico",
            base9: "Base 9",
            allowedChars9: "Caracteres permitidos: W, X, Y, Z, 0, 1, 2, 3, 4",
            decimalLabel: "Valor Decimal (Base 10):",
            tableTitle: "Tabela de Mapeamento",
            thNonary: "Nonário",
            thValue: "Valor",
            thTernary: "Ternário",
            langLabel: "EN",
            footerTitle: "Como funciona a conversão?",
            footerContent: `
                    <p>
                        A conversão entre o sistema <strong>ternário balanceado</strong> (base 3) e o <strong>nonário simétrico</strong> (base 9) é direta porque 9 é uma potência de 3 ($$3^2 = 9$$).
                        Isso significa que cada par de dígitos ternários (trits) corresponde exatamente a um dígito nonário.
                    </p>
                    <p>
                        Este processo é análogo à conversão entre binário (base 2) e hexadecimal (base 16), onde cada 4 bits ($$2^4 = 16$$) são agrupados em um dígito hexadecimal.
                        Aqui, agrupamos a cada 2 trits.
                    </p>
                    <ul class="list-disc pl-5 space-y-2 mt-2">
                        <li>
                            <strong>Quantidade par de dígitos:</strong> O número ternário <code>+ - 0 +</code> é agrupado como <code>(+ -) (0 +)</code>.
                            Consultando a tabela, <code>+ -</code> é <strong>2</strong> e <code>0 +</code> é <strong>1</strong>. Resultado: <strong>21</strong>.
                        </li>
                        <li>
                            <strong>Quantidade ímpar de dígitos:</strong> Para o número <code>- + 0</code>, adicionamos um zero à esquerda para completar o par: <code>(0 -) (+ 0)</code>.
                            Consultando a tabela, <code>0 -</code> é <strong>Z</strong> e <code>+ 0</code> é <strong>3</strong>. Resultado: <strong>Z3</strong>.
                        </li>
                    </ul>
                `
        },
        en: {
            title: "Symmetric Base Converter",
            subtitle: "Balanced Ternary (Base 3) ⇄ Symmetric Nonary (Base 9)",
            ternaryLabel: "Balanced Ternary (trits)",
            base3: "Base 3",
            allowedChars3: "Allowed characters: +, -, 0",
            nonaryLabel: "Symmetric Nonary",
            base9: "Base 9",
            allowedChars9: "Allowed characters: W, X, Y, Z, 0, 1, 2, 3, 4",
            decimalLabel: "Decimal Value (Base 10):",
            tableTitle: "Mapping Table",
            thNonary: "Nonary",
            thValue: "Value",
            thTernary: "Ternary",
            langLabel: "PT",
            footerTitle: "How does the conversion work?",
            footerContent: `
                    <p>
                        Converting between <strong>balanced ternary</strong> (base 3) and <strong>symmetric nonary</strong> (base 9) is straightforward because 9 is a power of 3 ($$3^2 = 9$$).
                        This means every pair of ternary digits (trits) corresponds exactly to one nonary digit.
                    </p>
                    <p>
                        This process is analogous to converting between binary (base 2) and hexadecimal (base 16), where every 4 bits ($$2^4 = 16$$) are grouped into one hexadecimal digit.
                        Here, we group every 2 trits.
                    </p>
                    <ul class="list-disc pl-5 space-y-2 mt-2">
                        <li>
                            <strong>Even number of digits:</strong> The ternary number <code>+ - 0 +</code> is grouped as <code>(+ -) (0 +)</code>.
                            Looking at the table, <code>+ -</code> is <strong>2</strong> and <code>0 +</code> is <strong>1</strong>. Result: <strong>21</strong>.
                        </li>
                        <li>
                            <strong>Odd number of digits:</strong> For the number <code>- + 0</code>, add a leading zero to complete the pair: <code>(0 -) (+ 0)</code>.
                            Looking at the table, <code>0 -</code> is <strong>Z</strong> and <code>+ 0</code> is <strong>3</strong>. Result: <strong>Z3</strong>.
                        </li>
                    </ul>
                `
        }
    };

    let currentLang = 'pt';

    function renderMath() {
        if (window.renderMathInElement) {
            renderMathInElement(document.getElementById('footerContentContainer'), {
                delimiters: [
                    {left: '$$', right: '$$', display: false}, // Inline math with $$ for simplicity here
                    {left: '$', right: '$', display: false},
                    {left: '\\(', right: '\\)', display: false},
                    {left: '\\[', right: '\\]', display: true}
                ],
                throwOnError : false
            });
        }
    }

    function setLanguage(lang) {
        if (!translations[lang]) lang = 'pt';
        currentLang = lang;
        document.documentElement.lang = lang === 'pt' ? 'pt-BR' : 'en';

        // Update regular text elements
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (translations[lang][key]) {
                el.textContent = translations[lang][key];
            }
        });

        // Update elements with HTML content (for the footer explanation)
        document.querySelectorAll('[data-i18n-html]').forEach(el => {
            const key = el.getAttribute('data-i18n-html');
            if (translations[lang][key]) {
                el.innerHTML = translations[lang][key];
            }
        });

        // Update special case: Language Toggle Button Label
        document.getElementById('langLabel').textContent = translations[lang].langLabel;

        // Re-render math after content change
        renderMath();

        // Update URL safely (try-catch for sandboxed environments)
        try {
            const url = new URL(window.location);
            url.searchParams.set('lang', lang);
            window.history.pushState({}, '', url);
        } catch (e) {
            // Sandbox might block pushState, which is fine.
        }
    }

    // Ensure KaTeX is loaded before initial render if possible, or render when it loads
    window.addEventListener('load', renderMath);

    // Initialize Language from URL or default
    const urlParams = new URLSearchParams(window.location.search);
    const initialLang = urlParams.get('lang');
    if (initialLang && ['pt', 'en'].includes(initialLang)) {
        setLanguage(initialLang);
    } else {
        setLanguage('pt'); // Default
    }

    // Language Toggle Event
    document.getElementById('langToggle').addEventListener('click', () => {
        const newLang = currentLang === 'pt' ? 'en' : 'pt';
        setLanguage(newLang);
    });


    // --- Core Converter Logic ---

    // Mapping definitions based on user request (W for -4)
    const mapTernaryToNonary = {
        '--': 'W', '-0': 'X', '-+': 'Y',
        '0-': 'Z', '00': '0', '0+': '1',
        '+-': '2', '+0': '3', '++': '4'
    };

    const mapNonaryToTernary = Object.fromEntries(
        Object.entries(mapTernaryToNonary).map(([k, v]) => [v, k])
    );

    const ternaryInput = document.getElementById('ternaryInput');
    const nonaryInput = document.getElementById('nonaryInput');
    const decimalDisplay = document.getElementById('decimalValue');

    // Core logic: Ternary to Decimal (for validation and display)
    function ternaryToDecimal(ternaryStr) {
        if (!ternaryStr) return 0;
        let decimal = 0;
        for (let i = 0; i < ternaryStr.length; i++) {
            const char = ternaryStr[ternaryStr.length - 1 - i];
            let val = 0;
            if (char === '+') val = 1;
            else if (char === '-') val = -1;
            decimal += val * Math.pow(3, i);
        }
        return decimal;
    }

    // Conversion: Ternary -> Nonary
    function convertTtoN(ternary) {
        if (!ternary) return '';
        // Ensure even length by padding with '0' on the left if necessary
        let paddedTernary = ternary.length % 2 !== 0 ? '0' + ternary : ternary;

        let nonary = '';
        for (let i = 0; i < paddedTernary.length; i += 2) {
            const pair = paddedTernary.substr(i, 2);
            nonary += mapTernaryToNonary[pair] || '';
        }

        // Clean up leading zeros in result (unless it's just "0")
        return nonary.replace(/^0+(?=[^0])/, '') || (nonary.includes('0') ? '0' : '');
    }

    // Conversion: Nonary -> Ternary
    function convertNtoT(nonary) {
        if (!nonary) return '';
        let ternary = '';
        for (let i = 0; i < nonary.length; i++) {
            ternary += mapNonaryToTernary[nonary[i].toUpperCase()] || '';
        }
        let cleaned = ternary.replace(/^0+/, '');
        return cleaned === '' && ternary.includes('0') ? '0' : (cleaned || '');
    }

    // Event Listeners for reactivity
    ternaryInput.addEventListener('input', (e) => {
        let val = e.target.value.replace(/[^+\-0]/g, '');
        if (val !== e.target.value) e.target.value = val;
        nonaryInput.value = convertTtoN(val);
        decimalDisplay.textContent = ternaryToDecimal(val).toLocaleString(currentLang === 'pt' ? 'pt-BR' : 'en-US');
    });

    nonaryInput.addEventListener('input', (e) => {
        let val = e.target.value.toUpperCase().replace(/[^WXYZ0-4]/g, '');
        if (val !== e.target.value.toUpperCase()) {
            const start = e.target.selectionStart;
            e.target.value = val;
            e.target.setSelectionRange(start, start);
        }
        const ternaryResult = convertNtoT(val);
        ternaryInput.value = ternaryResult;
        decimalDisplay.textContent = ternaryToDecimal(ternaryResult).toLocaleString(currentLang === 'pt' ? 'pt-BR' : 'en-US');
    });

</script>
</body>
</html>